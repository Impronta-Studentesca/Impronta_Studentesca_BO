<section class="page">
  <div class="head">
    <div class="left">
      <button class="btn btn--ghost" type="button" (click)="back()">← Dipartimenti</button>
      <div>
        <h1>Corsi di studio del dipartimento {{dipartimentoNome}} ({{dipartimentoCodice}})</h1>
        <p>Dipartimento ID: {{ dipartimentoId }}</p>
      </div>
    </div>

    <ng-container *ngIf="isDirettivo$ | async">
      <button class="btn btn--primary" type="button" (click)="openCreate()">
        + Nuovo corso
      </button>
    </ng-container>
  </div>

  <div class="error" *ngIf="errorMsg">{{ errorMsg }}</div>

  <div class="grid" *ngIf="!loading; else loadingTpl">
    <article class="card" *ngFor="let c of corsi">
      <div class="card__header">
        <h3 class="card__name">{{ c.nome }}</h3>
        <span class="pill">{{ TIPO_CORSO_LABEL[c.tipoCorso] }}</span>
      </div>

      <p class="hint" *ngIf="c.dipartimento">
        {{ c.dipartimento.nome }} ({{ c.dipartimento.codice }})
      </p>

      <ng-container *ngIf="isDirettivo$ | async">
        <div class="card__footer">
          <button class="btn btn--ghost" type="button" (click)="openEdit(c)">Modifica</button>
          <button class="btn btn--danger" type="button" (click)="openDeleteModal(c)">Elimina</button>
        </div>
      </ng-container>
    </article>
  </div>

  <ng-template #loadingTpl>
    <div class="loading">Caricamento…</div>
  </ng-template>

  <!-- MODAL create/edit -->
  <div class="modal" *ngIf="modalOpen">
    <div class="modal__panel" (click)="$event.stopPropagation()">
      <div class="modal__head">
        <h2>{{ editing ? 'Modifica corso' : 'Nuovo corso' }}</h2>
        <button class="x" type="button" (click)="closeModal()">×</button>
      </div>

      <form class="form" [formGroup]="form" (ngSubmit)="save()">
        <label class="field">
          <span>Nome</span>
          <input formControlName="nome" placeholder="Es. Scienze della Formazione Primaria" />
        </label>

        <label class="field">
          <span>Tipo corso</span>
          <select formControlName="tipoCorso">
            <option *ngFor="let t of tipoCorsoOptions" [value]="t">
              {{ TIPO_CORSO_LABEL[t] }}
            </option>
          </select>
        </label>

        <div class="modal__actions">
          <button class="btn btn--ghost" type="button" (click)="closeModal()">Annulla</button>
          <button class="btn btn--primary" type="submit" [disabled]="loading">
            {{ editing ? 'Salva' : 'Crea' }}
          </button>
        </div>
      </form>
    </div>

    <div class="modal__backdrop" (click)="closeModal()"></div>
  </div>
</section>

<!-- MODALE CONFERMA ELIMINAZIONE -->
<div class="modal" *ngIf="deleteModalOpen">
  <div class="modal__panel" (click)="$event.stopPropagation()">
    <div class="modal__head">
      <h2>Conferma eliminazione</h2>
      <button class="x" type="button" (click)="closeDeleteModal()">×</button>
    </div>

    <ng-container *ngIf="toDelete as x">
      <p class="modal__text">
        Vuoi davvero eliminare il corso
        <strong>{{ x.nome }}</strong>?
      </p>

      <div class="modal__actions">
        <button class="btn btn--ghost" type="button" (click)="closeDeleteModal()">Annulla</button>
        <button class="btn btn--danger" type="button" (click)="confirmDelete()" [disabled]="loading">
          Conferma
        </button>
      </div>
    </ng-container>
  </div>

  <div class="modal__backdrop" (click)="closeDeleteModal()"></div>
</div>
